#!/bin/bash

set -e

d=$(dirname $0)

if [ "${OSTYPE:0:6}" = "darwin" ]; then
	if ! command -v zstd &>/dev/null; then
		echo "Please install [zstd] (un)compression tool"
		echo "For example:"
		echo "  brew install zstd"
		exit 255
	fi
	binary="${d}/darwin/dataTypesGenerator"
else
	if ! command -v zstd &>/dev/null; then
		echo "Please install [zstd] (un)compression tool"
		echo "For example:"
		echo "  apt install zstd"
		exit 255
	fi
	binary="${d}/linux/dataTypesGenerator"
fi

rm -f "${binary}"
trap "rm -f \"${binary}\"" 1 2 3 6 EXIT
zstd -d -q -f -o "${binary}" "${binary}.zst"
chmod u+x "${binary}"
${binary} "$@"
